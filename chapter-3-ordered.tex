\chapter{Substructural logic}

Linear logic is the most famous of the {\it substructural logics}.
Persistent logic admits the three so-called {\it structural rules} of
weakening (premises need not be used), contraction (premeses may be
used multiple times) and exchange (the ordering of premises are 
irrelevant). Substructural logics, then, are logics that do not admit
these structural rules -- linear logic has only exchange, 
{\it affine} logic (which is frequently conflated with linear logic
by programming language designers) has exchange and weakening, and
{\it ordered} logic, first investigated as a proof theory by Lambek
\cite{lambek58mathematics}, lacks all three. 

Calling logics like linear, affine, and ordered logic
\underline{sub}structural relative to persistent logic (which is
structural) is arguably unfair to the substructural logics. Girard's
linear logic can express persistent provability using the exponential
connective ${!}A$, and this idea is generally applicable in
substructural logics -- for instance, it was applied by Polakow and
Pfenning to Lambek's ordered logic
\cite{polakow99natural}.\robnote{Check citation.} 

This section defines a first-order ordered linear logic that includes
a lax modality; a fragment of this system will form the basis of our
logical framework in Chapter 4. The full focusing system for ordered
linear lax logic is presented in this chapter in keeping with
Andreoli's insistance that we avoid the confusion that results from
conflating ``defining a foundational paradigm or a [logic] programming
language (two objectives that should clearly be kept separate)''
\cite{andreoli01focussing}, a concern that is applicable for logical
frameworks as well as for logic programming
langauges.\footnote{As Twelf, Lollimon, and Celf
  show, logical frameworks can frequently be given straightforward
  life as logic programming languages
  \cite{pfenning99system,lopez05monadic,schacknielsen08celf}.} I 
also believe that a full exposition of this logic is useful because
of the possibility that many other interesting and tractable logic
programming languages can be defined as fragments of this logic.

\section{Ordered linear lax logic}

Ordered linear logic was the subject of Polakow's thesis
\cite{polakow01ordered}, and the adaptation of Fairtlough and
Mendler's lax logic \cite{fairtlough95propositional} (as reconstructed
by Pfenning and Davies \cite{pfenning01judgmental}) to linear logic is
the basis of the CLF logical framework
\cite{watkins02concurrent}. Putting the pieces together 
is a straightforward proof-theoretic exercise. There are three contexts
relevant to the propositional presentation of ordered linear lax logic.
The persistent context $\Gamma$ and the linear context $\Delta$
are multisets as before (so we think of $\Delta_1, \Delta_2$ as being
equal to $\Delta_2, \Delta_1$, for instance). The ordered context
$\Omega$ is a sequence of propositions, as in Gentzen's original
presentation of sequent calculi, and {\it not} a multiset.
This means that the two ordered
contexts $\Omega_1, \Omega_2$ and $\Omega_2, \Omega_1$ are, in general,
not the same.

\input{figs/fig-ordered-prop}

There are two judgments in ordered linear lax logic (henceforth \ollll). 
The primary
judgment is $\oseq{\Gamma}{\Delta}{\Omega}{\istrue{A}}$, which says
that $A$ is an (ephemeral, ordered) resource derivable from the
persistent resources in $\Gamma$, the ephemeral resources in $\Delta$,
and the ephemeral, ordered resources in $\Omega$. There is also a
second judgment, $\oseq{\Gamma}{\Delta}{\Omega}{\islax{A}}$. The
judgment $\islax{A}$ is usually interpreted as truth under an
unspecified constraint; one defining characteristic of the lax
modality is that it if $\istrue{A}$ is derivable with 
some resources then $\islax{A}$ is derivable with the same resources.

Compare this to the relationship between persistent and lax truth in
linear logic, where the defining characteristic is that a persistent
resource (associated with judgments of the form 
$\ispers{A}$ in $\Gamma$) can
always satisfy the need for an ephemeral resource (associated with
judgments of the form $\iseph{A}$ in $\Delta$). In the previous
chapter, we first encoded this relationship as an explicit rule
${\it copy}$:
\[
\infer[{\it copy}]
{\seq{\Gamma, \ispers{A}}{\Delta}{\iseph{C}}}
{\seq{\Gamma, \ispers{A}}{\Delta, \iseph{A}}{\iseph{C}}}
\]
In Section~\ref{sec:linnote}, based on a discussion of synthetic
connectives under the atom optimization, we considered a revision
in which the ${\it copy}$ rule was admissibile and 
left rules had conclusions that used the
construct $\altseq{\Gamma}{\Delta/A}{C}$,
which matches a sequent of the form $\altseq{\Gamma}{\Delta'}{C}$ 
if either $A \in \Gamma$ and $\Delta' = \Delta$ or if
$\Delta' = \Delta, A$. The $\oplus_L$ rule in this logic is as follows:
\[
\infer[{\oplus}_L]
{\altseq{\Gamma}{\Delta/A \oplus B}{\iseph{C}}}
{\altseq{\Gamma}{\Delta, \iseph{A}}{\iseph{C}}
 &
 \altseq{\Gamma}{\Delta, \iseph{B}}{\iseph{C}}}
\]

Lax truth can be considered along the same lines, accoutning for the
fact that we're now using the much briefer $\istrue{A}$ instead of
$\iseph{A}$ to capture the judgment assocated with ordered, ephemeral
resources.  To follow existing judgmental presentations of lax logic,
we would include a distinct rule ${\it lax}$ that derives lax truth
from regular truth.
\[
\infer[{\it lax}]
{\Gamma; \Delta; \Omega \longrightarrow \islax{A}}
{\Gamma; \Delta; \Omega \longrightarrow \istrue{A}}
\]
The alternative is to rewrite all the right rules with a construct
$\orseq{\Gamma}{\Delta}{\Omega}{A}$ that matches both 
sequents of the form $\otseq{\Gamma}{\Delta}{\Omega}{A}$
and sequents of the form $\oseq{\Gamma}{\Delta}{\Omega}{\islax{A}}$.
The use of this construct gives us right rules for 
$A \oplus B$ that look like this:
\[
\infer[{\oplus}_{R1}]
{\orseq{\Gamma}{\Delta}{\Omega}{A \oplus B}}
{\otseq{\Gamma}{\Delta}{\Omega}{A}}
\qquad
\infer[{\oplus}_{R2}]
{\orseq{\Gamma}{\Delta}{\Omega}{A \oplus B}}
{\otseq{\Gamma}{\Delta}{\Omega}{B}}
\]
The related notation on the left-hand side is the construct 
$\olseq{\Gamma}{\Delta}{\Omega_L}{A}{\Omega_R}$, which matches
the sequent $\oseq{\Gamma}{\Delta'}{\Omega'}{U}$ if
\begin{itemize}
\item $\Omega' = \Omega_L, A, \Omega_R$ and $\Delta' = \Delta$;
\item $\Omega' = \Omega_L, \Omega_R$ and $\Delta' = \Delta, A$;
\item $\Omega' = \Omega_L, \Omega_R$, $\Delta' = \Delta$, and $A \in \Gamma$.
\end{itemize}
This style of presentation, use in Figure~\ref{fig:ordered-prop},
excludes the ${\it copy}$ and ${\it place}$ rules from Polakow's 
presentation; both rules are, however, admissible.

\subsection{First-order logic}

The presentation in Figure~\ref{fig:ordered-prop} is propositional; by 
uniformly adding a first-order context $\Psi$ to all sequents, however,
it can be treated as first-order. We define 
quantification (existential and universal), as well as 
first-order equality, in Figure~\ref{fig:ordered-fo}.

\input{figs/fig-ordered-fo}

The equality judgment $t \doteq s$ deserves some attention. It is a
higher-order judgment, in the sense that it reflects over the
definition of simultaneous term substitutions $\Psi' \vdash \theta :
\Psi$ and over the equality judgment for first-order terms $t =
s$. This is a rule that, in general, will have countably many
premises; in the case of a trivially satisfiable equality problem like
$x \doteq x$ it will have one premise for each well-formed
substitution that substitutes a term of the appropriate type for
$x$. This exact style of presentation was used previously in 
\cite{simmons09weak}, but the approach is based on Schroeder-Heister's
treatment of definitional reflection \cite{schroeder93rules}.

There are two important special cases. First, an unsatisfiable 
equation on the left implies a contradiction, and the left rule
for equality is equivalent to one with no premises. For instance, this
means that
\[
\infer
{\olfseq{\Gamma}{\Delta}{\Omega_L}{0 \doteq 1}{\Omega_R}}
{}
\]
is derivable. The other important special case is when
$t$ and $s$ have a  {\it most general unifier} $\theta_{\it mgu}$, 
which just means that for all $\Psi' \vdash \theta : \Psi$ such that 
$\theta t = \theta s$,
it is the case that $\theta = \theta' \circ \theta_{\it mgu}$ for some 
$\theta'$.\footnote{Where $\circ$ is composition -- 
$(\theta' \circ \theta_{\it mgu})t = \theta'(\theta t)$.} In this
case, the left rule for equality is equivalent to the following
rule:
\[
\infer
{\olfseq{\Gamma}{\Delta}{\Omega_L}{t \doteq s}{\Omega_R}}
{{\it mgu}(t, s) = \Psi \vdash \theta : \Psi'
 &
 \ofirstseq{\Psi'}{\theta\Gamma}{\theta\Delta}{\theta\Omega_L, \theta\Omega_R}{\theta U}}
\]

We have not yet thoroughly specified the type and term structure of
first-order individuals; in the next chapter we clarify that these
types and terms will actually be types and terms of Canonical LF.

\section{Substructural contexts}

First-ordered linear lax logic has a lot of contexts -- the persistent
context $\Gamma$ the linear context $\Delta$, and the ordered context
$\Omega$, not to mention the first-order context $\Psi$. In most rules
these contexts just hang around, obscuring the logic's presentation
and ensuring that the {\LaTeX} code of figures and displays remains
permanently unreadable. And there are yet more contexts we might want to 
add, such as the affine contexts present in the Celf implementation.

In this section, we will consider a more compact way of dealing with
the contexts which we think of as containing resources (persistent,
affine, linear, or ordered), though we will maintain the distinction
between resource contexts and first-order variable 
contexts $\Psi$.  The first step
has already been take in Figure~\ref{fig:linear-alt} and
Figure~\ref{fig:ordered-prop}, which make it quite obvious that the
context-{\it matching} notation that we perform in the conclusion of
an inference rule may not be the same as the context-{\it extending}
notation we use in the premise of that rule. 

We will treat unified contexts fundamentally as mappings from
variables ($x$, $y$, $z$, etc.) to judgments $A\,{\it lvl}$. For the
purposes of representing the contexts of \ollll, we can
also think of unified contexts of the form
\[
\Xi ::= \cdot 
  \mid \Xi, x{:}\ispers{A^-}
  \mid \Xi, x{:}\ispers{A^-}
  \mid \Xi, x{:}\iseph{A^-}
  \mid \Xi, x{:}\iseph{A^-}
  \mid \Xi, x{:}\istrue{A^-}
  \mid \Xi, x{:}\istrue{A^-}
\]
where these three judgments are associated with propositions from the
persistent, linear, and ordered contexts $\Gamma$, $\Delta$, and
$\Omega$ (respectively). We will refer to substructural contexts as
$\Xi$ when necessary to avoid confusion with linear contexts $\Delta$,
though we will generally prefer the metavariable $\Delta$ to describe
substructural contexts.

we need three
judgments in the context: $\ispers{A}$, the persistent judgment
(otherwise associated with the context $\Gamma$); $\iseph{A}$, the
ephemeral judgment (otherwise associated with the context $\Delta$);
and the ordered judgment $\istrue{A}$ (otherwise associated with the
context $\Omega$). For the focused system we will need one more, 
$A\,{\it susp}$, associated with suspended positive propositions
$\langle A^+ \rangle$. 

\subsection{Fundamental operations on contexts}

The fundamental constructor of a singleton context is the 
$x{:}A\,{\it lvl}$ 

The second fundamental operation on a context is splitting
the context into an inside and an outside: we say
$\Xi = \frameoff{\Theta}{\Xi'}$. 
If we 
$\Xi = \Gamma; \Delta, \Delta'; \Omega_L, \Omega, \Omega_R$,
the one possible match is to let 
$\Theta = \Gamma; \Delta; \Omega_L, \Box, \Omega_R$ and to 
let $\Xi = \Gamma; \Delta'; \Omega$. 

\[
\infer[]
{\frameoff{\Theta}{A \oplus B} \Rightarrow U}
{\tackon{\Theta}{x{:}\istrue{A}} \Rightarrow U
 &
 \tackon{\Theta}{y{:}\istrue{B}} \Rightarrow U}
\]

We can also use this notation to describe the one of the
cut principles for ordered linear lax logic. 
\[
\infer-[{\it cut}]
{\frameoff{\Theta}{\Xi} \Rightarrow \istrue{C}}
{\Xi \Rightarrow \istrue{A}
 &
 \tackon{\Theta}{x{:}A\,{\it true}} \Rightarrow \istrue{C}}
\]
The idea that the operators $\frameoff{\Theta}{\Xi}$
and $\tackon{\Theta}{\Xi}$ are sufficient to describe the 
cut principle is related to the display property, which fails
for some reasonable logics, such as Reed's queue logic
\cite{reed09queue}.

\subsection{Multiplicative operatons}

\subsection{Exponential operations}

\[
\infer-[{\it cut}]
{\frameoff{\Theta}{\Xi} \Rightarrow \istrue{C}}
{\Xi{\downharpoonright}_{\it lvl} \Rightarrow \istrue{A}
 &
 \tackon{\Theta}{x{:}A\,{\it lvl}} \Rightarrow \istrue{C}}
\quad
\infer-[\{{\it cut}\}]
{\frameoff{\Theta}{\Xi} \Rightarrow \islax{C}}
{\Xi \Rightarrow \islax{A}
 &
 \tackon{\Theta}{x{:}\istrue{A}} \Rightarrow \istrue{C}}
\]


We need one fundamental . A context $\Xi$

The fundamental constructor of a context is 
$x{:}A\,{\it lvl}$



We now have a {\it lot} of 

We will treat {\it substructural contexts} $\Delta$ are maps from {\it
  variables} to {\it judgments}. There are two kinds of variables: 
those that map {\it extent}.




Two of the fundamental propeties of $\Delta$ are 
$x{:}\langle A^+ \rangle_l \sqsubseteq \Delta$. In linear logic, this
is the statement that $x{:}A \in \Gamma$, whereas in 

\[\small
\begin{array}{|c|c|c|c|}
%
\begin{array}{c}
\makebox[1.8in]{\it Dual intuitionstic linear logic}\medskip
\\
\infer
{\Gamma; p^+ \vdash p^+ \mathstrut}
{\mathstrut}
\end{array}
%
&
%
\begin{array}{c}
\makebox[1.8in]{\it Pfenning-Davies S4}\medskip
\\
\infer
{\Delta; \Gamma, p^+ \mathstrut \vdash p^+}
{\mathstrut}
\end{array}
%
&
%
\begin{array}{c}
\makebox[1.8in]{\it Unified}\medskip
\\
\infer
{\Delta \vdash [ p^+ ]_l \mathstrut}
{x{:}\langle p^+ \rangle_l \subseteq \Delta \mathstrut}
\end{array}
%
\end{array}
\]

\[\small
\begin{array}{|c|c|c|c|}
%
\begin{array}{c}
\makebox[1.8in]{\it Dual intuitionstic linear logic}\medskip
\\
\infer
{\Gamma; \Delta, A \with B \vdash C \mathstrut}
{\Gamma; \Delta, A \vdash C \mathstrut}
\end{array}
%
&
%
\begin{array}{c}
\makebox[1.8in]{\it Pfenning-Davies S4}\medskip
\\
\infer
{\Delta; \Gamma, A \wedge^- B \mathstrut \vdash C}
{\Delta; \Gamma, A \wedge^- B, A \vdash C \mathstrut}
\end{array}
%
&
%
\begin{array}{c}
\makebox[1.8in]{\it Unified}\medskip
\\
\infer
{\Theta\{ x{:} A \with B \} \vdash U \mathstrut}
{\Theta\{ x_1{:} A \} \vdash U \mathstrut}
\end{array}
%
\end{array}
\]


\[\small
\begin{array}{|c|c|c|c|}
%
\begin{array}{c}
\makebox[1.8in]{\it Dual intuitionstic linear logic}\medskip
\\
\infer
{\Gamma; \Delta_1, \Delta_2 \vdash A \otimes B \mathstrut}
{\Gamma; \Delta_1 \vdash A & \Gamma; \Delta_2 \vdash B \mathstrut}
\end{array}
%
&
%
\begin{array}{c}
\makebox[1.8in]{\it Pfenning-Davies S4}\medskip
\\
\infer
{\Delta; \Gamma \vdash A \wedge^+ B \mathstrut}
{\Delta; \Gamma \vdash A & \Delta; \Gamma \vdash B \mathstrut}
\end{array}
%
&
%
\begin{array}{c}
\makebox[1.8in]{\it Unified}\medskip
\\
\infer
{\Delta_1 \bowtie \Delta_2 \vdash A \otimes B \mathstrut}
{\Delta \vdash A & \Delta_2 \vdash B \mathstrut}
\end{array}
%
\end{array}
\]



\section{Explicit shifts in focusing}

\section{Polarization and erasure}

\section{Cut admissibility}

\section{Identity expansion}

\section{Unfocused admissibility}

\section{Soundness and completeness}


